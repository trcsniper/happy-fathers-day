<!DOCTYPE html>
<html>
	<head>
		<title>Happy Father's Day!</title>

		<style>
			body {
				margin: 0px;
				padding: 0px;
			}

			.variable-label {
				font-family: 'Times New Roman', Times, serif;
				font-style: italic;
			}

			.variable-value {
				font-weight: bold;
			}

			#parallax-stack {
				overflow: hidden;
				position: relative;
				width: 1920px;
				height: 1080px;
			}

			.parallax {
				position: absolute;
				width: 100%;
				height: 100%;
			}

			.content-background {
				background-image: url(./parallax-layer-back.png);
				background-size: cover;
				background-position-x: center;
				background-position-y: center;
				margin: -10% 0% 0% -10%;
				padding: 10% 10% 10% 10%;
			}

			.content-foreground {
				background-image: url(./parallax-layer-front.png);
				background-size: cover;
				background-position-x: right;
				background-position-y: bottom;
			}

			.content-message {
			}

			.content-message div {
				margin-top: 50px;
				font-size: 96pt;
				text-align: center;
				line-height: 85%;
			}
		</style>

		<script>
			var parallaxParent;
			var parallaxElements;

			var prevMouseX = 0;
			var prevMouseY = 0;

			var tiltX = 0;
			var tiltY = 0;

			var rotationSampleCount = 10;
			var rotationSampleIndex = 0;
			var rotationSamplesX = [];
			var rotationSamplesY = [];

			window.onload = function() {
				parallaxParent = document.getElementById("parallax-stack");
				parallaxElements = parallaxParent.getElementsByClassName("parallax");

				for (let sampleIndex = 0; sampleIndex < rotationSampleCount; sampleIndex++) {
					rotationSamplesX[sampleIndex] = 0;
					rotationSamplesY[sampleIndex] = 0;
				}

				setCanvasSize(document.documentElement.clientWidth, document.documentElement.clientHeight);

				if (window.DeviceOrientationEvent) {
					window.addEventListener(
						"deviceorientation",
						function (event) {
							document.getElementById("device-alpha").innerText = event.alpha.toFixed(2) + " deg";
							document.getElementById("device-beta").innerText = event.beta.toFixed(2) + " deg";
							document.getElementById("device-gamma").innerText = event.gamma.toFixed(2) + " deg";
						},
						true
						);
				}
				
				if (window.DeviceMotionEvent) {
					window.addEventListener(
						"devicemotion",
						function (event) {
							document.getElementById("device-x").innerText = event.acceleration.x.toFixed(2) + " m/s^2";
							document.getElementById("device-y").innerText = event.acceleration.y.toFixed(2) + " m/s^2";
							document.getElementById("device-z").innerText = event.acceleration.z.toFixed(2) + " m/s^2";

							document.getElementById("device-dalpha").innerText = event.rotationRate.alpha.toFixed(2) + " deg/s";
							document.getElementById("device-dbeta").innerText = event.rotationRate.beta.toFixed(2) + " deg/s";
							document.getElementById("device-dgamma").innerText = event.rotationRate.gamma.toFixed(2) + " deg/s";

							rotationSamplesX[rotationSampleIndex] = event.rotationRate.beta;
							rotationSamplesY[rotationSampleIndex] = event.rotationRate.alpha;
							rotationSampleIndex = ++rotationSampleIndex % rotationSampleCount;

							var averageRotationX = 0;
							var averageRotationY = 0;

							for (let sampleIndex = 0; sampleIndex < rotationSampleCount; sampleIndex++) {
								averageRotationX += rotationSamplesX[sampleIndex];
								averageRotationY += rotationSamplesY[sampleIndex];
							}

							averageRotationX /= rotationSampleCount;
							averageRotationY /= rotationSampleCount;

							tilt(averageRotationX * 0.001, averageRotationY * 0.001);
						},
						true
						);
				}
			}

			window.onresize = function() {
				setCanvasSize(document.documentElement.clientWidth, document.documentElement.clientHeight);
			}

			window.onmousemove = function(event) {
				mouseX = event.clientX;
				mouseY = event.clientY;

				document.getElementById("mouse-x").innerText = "" + mouseX;
				document.getElementById("mouse-y").innerText = "" + mouseY;
				document.getElementById("mouse-dx").innerText = "" + (mouseX - prevMouseX);
				document.getElementById("mouse-dy").innerText = "" + (mouseY - prevMouseY);

				tilt((mouseX - prevMouseX) * 0.001, (mouseY - prevMouseY) * 0.001);

				prevMouseX = mouseX;
				prevMouseY = mouseY;
			}

			function setCanvasSize(x, y) {
				parallaxParent.style.width = x + "px";
				parallaxParent.style.height = y + "px";
			}
			
			function clamp(value, min, max) {
				return Math.max(Math.min(value, max), min);
			}
			
			function tilt(x, y) {
				tiltX = clamp(tiltX + x, -1, 1);
				tiltY = clamp(tiltY + y, -1, 1);

				document.getElementById("tilt-x").innerText = "" + (tiltX.toFixed(2));
				document.getElementById("tilt-y").innerText = "" + (tiltY.toFixed(2));

				Array.prototype.forEach.call(
					parallaxElements,
					function(element) {
						var scale = element.getAttribute("parallax-scale");
						element.style.transform = "translate(" + (tiltX * scale * 100) + "%, " + (tiltY * scale * 100) + "%)";
					}
					);
			}
		</script>
	</head>
	<body>
		<div id="parallax-stack">
			<div class="parallax content-background" parallax-scale="-0.05"></div>
			<div class="parallax content-foreground" parallax-scale="0.05"></div>
			<div class="parallax content-message" parallax-scale="0.15"><div>HAPPY<br />FATHER'S<br />DAY!</div></div>
		</div>
		<p>Device Orientation<br /><span class="variable-label">α</span>: <span id="device-alpha" class="variable-value">0</span>, <span class="variable-label">β</span>: <span id="device-beta" class="variable-value">0</span>, <span class="variable-label">γ</span>: <span id="device-gamma" class="variable-value">0</span></p>
		<p>Device Acceleration<br /><span class="variable-label">x</span>: <span id="device-x" class="variable-value">0</span>, <span class="variable-label">y</span>: <span id="device-y" class="variable-value">0</span>, <span class="variable-label">z</span>: <span id="device-z" class="variable-value">0</span></p>
		<p>Device Rotation<br /><span class="variable-label">δα</span>: <span id="device-dalpha" class="variable-value">0</span>, <span class="variable-label">δβ</span>: <span id="device-dbeta" class="variable-value">0</span>, <span class="variable-label">δγ</span>: <span id="device-dgamma" class="variable-value">0</span></p>
		<p>Mouse Movement<br /><span class="variable-label">δx</span>: <span id="mouse-dx" class="variable-value">0</span>, <span class="variable-label">δy</span>: <span id="mouse-dy" class="variable-value">0</span></p>
		<p>Curosr Location<br /><span class="variable-label">δx</span>: <span id="mouse-x" class="variable-value">0</span>, <span class="variable-label">δy</span>: <span id="mouse-y" class="variable-value">0</span></p>
		<p>Parallax Tilt<br /><span class="variable-label">x</span>: <span id="tilt-x" class="variable-value">0</span>, <span class="variable-label">δy</span>: <span id="tilt-y" class="variable-value">0</span></p>
	</body>
<html>
